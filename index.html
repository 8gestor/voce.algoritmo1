<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Dashboard // Painel de Controle Soberano</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-app: #030303;        
            --bg-panel: rgba(10, 10, 12, 0.98);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #777777;
            --accent: #3b82f6;        
            --accent-dim: rgba(59, 130, 246, 0.15);
            --accent-glow: 0 0 20px rgba(59, 130, 246, 0.4);
            --font-tech: 'JetBrains Mono', monospace;
            --blur: blur(25px);
        }

        body.light-mode {
            --bg-app: #f0f0f5;
            --bg-panel: rgba(255, 255, 255, 0.98);
            --border-color: rgba(0, 0, 0, 0.1);
            --text-primary: #111111;
            --text-secondary: #555555;
            --accent: #2563eb;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        html, body { height: 100%; width: 100%; overflow: hidden; background-color: var(--bg-app); }
        body { display: flex; font-family: 'Inter', sans-serif; transition: background 0.5s ease; }

        /* --- SIDEBAR --- */
        aside.sidebar {
            width: 320px; background: var(--bg-panel); border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column; flex-shrink: 0; z-index: 500;
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1); backdrop-filter: var(--blur);
        }
        aside.sidebar.collapsed { transform: translateX(-320px); position: absolute; height: 100%; }
        .sidebar-header { height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 1px solid var(--border-color); }
        nav.nav-list { flex: 1; overflow-y: auto; padding: 20px 0 20px 20px; }
        .nav-category { font-family: var(--font-tech); font-size: 0.65rem; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; margin: 25px 0 10px 10px; border-left: 2px solid var(--accent); padding-left: 10px; }
        .chapter-link { position: relative; display: flex; align-items: center; padding: 12px 20px; margin-bottom: 4px; color: var(--text-secondary); text-decoration: none; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; transition: all 0.2s; border-radius: 8px 0 0 8px; }
        .chapter-link:hover { color: var(--text-primary); background: rgba(255,255,255,0.03); }
        .chapter-link.active { color: var(--text-primary); background: var(--accent); box-shadow: var(--accent-glow); }

        /* --- DASHBOARD CORE --- */
        main.dashboard { flex: 1; display: flex; flex-direction: column; height: 100%; width: 100%; overflow: hidden; }

        /* --- CABEÇALHO HORIZONTAL (TRAVADO) --- */
        .master-header {
            display: flex; flex-direction: column; width: 100%; background: var(--bg-panel); 
            backdrop-filter: var(--blur); border-bottom: 1px solid var(--border-color); z-index: 400;
        }

        .control-row {
            height: 65px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; width: 100%; 
            flex-wrap: nowrap !important; /* IMPEDE VERTICALIZAÇÃO */
            overflow-x: auto; /* PERMITE SCROLL SE MUITO PEQUENO */
        }
        .control-row::-webkit-scrollbar { display: none; }

        .hud-left, .hud-right { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }

        .branding-row {
            height: 40px; display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.3); border-top: 1px solid rgba(255,255,255,0.03);
            position: relative; overflow: hidden; padding: 0 15px;
        }

        .dynamic-title {
            font-family: var(--font-tech); font-size: clamp(0.6rem, 2.5vw, 0.8rem); 
            font-weight: 800; color: var(--accent); text-transform: uppercase; 
            letter-spacing: 1.5px; animation: breathe 4s infinite ease-in-out; 
            z-index: 2; text-align: center; white-space: nowrap;
        }

        /* --- BOTÕES TÉCNICOS --- */
        .ctrl-btn {
            width: 40px; height: 40px; min-width: 40px; background: rgba(255,255,255,0.03); 
            border: 1px solid var(--border-color); color: var(--text-secondary);
            border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; font-family: var(--font-tech); font-weight: 800;
        }
        .ctrl-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-dim); }
        .ctrl-btn.active-state { color: var(--accent); border-color: var(--accent); background: var(--accent-dim); box-shadow: var(--accent-glow); }
        
        .speed-control { display: flex; align-items: center; background: rgba(0,0,0,0.3); border-radius: 10px; border: 1px solid var(--border-color); height: 40px; padding: 0 5px; }
        .speed-btn { background: none; border: none; color: var(--text-secondary); font-family: var(--font-tech); font-size: 0.8rem; padding: 0 10px; cursor: pointer; font-weight: 800; }
        #speed-val { font-family: var(--font-tech); font-size: 0.75rem; color: var(--accent); min-width: 35px; text-align: center; font-weight: 800; }

        /* --- VIEWPORT --- */
        .viewport { flex: 1; position: relative; background: #000; overflow: hidden; display: flex; flex-direction: column; }
        iframe { flex: 1; width: 100%; height: 100%; border: none; }

        /* --- RODAPÉ --- */
        footer.bottom-hud {
            min-height: 90px; background: var(--bg-panel); backdrop-filter: var(--blur);
            border-top: 1px solid var(--border-color); display: flex; align-items: center;
            justify-content: space-between; padding: 10px 15px; flex-shrink: 0;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
        }

        .progress-zone { display: flex; flex-direction: column; align-items: center; gap: 8px; flex: 1; margin: 0 10px; }
        .progress-track { width: 100%; max-width: 250px; height: 5px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.05); }
        #progress-fill { position: absolute; height: 100%; background: var(--accent); width: 0%; transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1); box-shadow: 0 0 15px var(--accent); }
        .progress-percentage { font-family: var(--font-tech); font-size: 0.7rem; color: var(--accent); font-weight: 800; }
        .nav-btn { height: 48px; padding: 0 18px; background: rgba(255,255,255,0.02); border: 1px solid var(--border-color); color: #fff; border-radius: 12px; font-family: var(--font-tech); font-size: 0.75rem; font-weight: 800; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .nav-btn:hover:not(:disabled) { border-color: var(--accent); color: var(--accent); background: var(--accent-dim); }

        @keyframes scan { 0% { left: -100%; } 100% { left: 100%; } }
        @keyframes breathe { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; text-shadow: 0 0 15px var(--accent); } }

        @media (max-width: 768px) {
            aside.sidebar { position: absolute; height: 100%; transform: translateX(-320px); }
            aside.sidebar.open { transform: translateX(0); box-shadow: 30px 0 60px #000; }
            .font-control-group { display: none; }
            .dynamic-title { font-size: 0.55rem; }
            .progress-track { max-width: 140px; }
            .ctrl-btn { width: 36px; height: 36px; min-width: 36px; }
            .speed-control { height: 36px; }
        }
    </style>
</head>
<body class="dark-mode">

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div style="font-family:var(--font-tech); font-size:0.8rem; color:var(--accent); font-weight:800; letter-spacing:1px;">OS // CORE V30</div>
            <button class="ctrl-btn" style="border:none;" onclick="toggleSidebar()">✕</button>
        </div>
        <nav class="nav-list" id="links-container"></nav>
    </aside>

    <main class="dashboard">
        <div class="master-header">
            <div class="control-row">
                <div class="hud-left">
                    <button class="ctrl-btn" onclick="toggleSidebar()" title="MENU">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                    </button>
                </div>

                <div class="hud-right">
                    <div class="hud-left font-control-group">
                        <button class="ctrl-btn" onclick="controlFont('smaller')">A-</button>
                        <button class="ctrl-btn" onclick="controlFont('larger')">A+</button>
                    </div>

                    <div class="speed-control">
                        <button class="speed-btn" onclick="controlTTS(-0.25)">-</button>
                        <span id="speed-val">1.0X</span>
                        <button class="speed-btn" onclick="controlTTS(0.25)">+</button>
                    </div>
                    
                    <button class="ctrl-btn" id="btn-play" onclick="sendTTS('tts-toggle')" title="VOZ">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                    </button>

                    <button class="ctrl-btn" onclick="toggleTheme()" title="TEMA">
                        <svg id="theme-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    </button>

                    <button class="ctrl-btn" onclick="toggleFullScreen()" title="TELA CHEIA">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
                    </button>
                </div>
            </div>

            <div class="branding-row">
                <div class="dynamic-title">A VERSÃO DE VOCÊ QUE OS ALGORÍTIMOS ACREDITAM QUE VOCÊ É</div>
            </div>
        </div>

        <div class="viewport">
            <iframe id="main-frame" name="viewer" src="introducao.html"></iframe>
        </div>

        <footer class="bottom-hud">
            <button class="nav-btn" id="btn-prev" onclick="navigate(-1)">ANTERIOR</button>
            <div class="progress-zone">
                <div id="cap-label" style="font-size:0.75rem; font-weight:800; text-transform:uppercase; color:#fff; letter-spacing:1px; text-align:center;">INTRODUÇÃO</div>
                <div class="progress-track"><div id="progress-fill"></div></div>
                <div class="progress-percentage" id="progress-percent">0%</div>
            </div>
            <button class="nav-btn" id="btn-next" onclick="navigate(1)">PRÓXIMO</button>
        </footer>
    </main>

    <script>
        const chapters = [
            {t: "Introdução", f: "introducao.html", cat: "BOOT SEQUENCE"},
            {t: "Cérebro não é PC", f: "cap01.html", cat: "MÓDULO MENTAL"},
            {t: "Sequestro da Atenção", f: "cap02.html", cat: "MÓDULO MENTAL"},
            {t: "O Eu Inferido", f: "cap03.html", cat: "MÓDULO MENTAL"},
            {t: "Necropolítica Digital", f: "cap04.html", cat: "MÓDULO FÍSICO"},
            {t: "Smart Cities", f: "cap05.html", cat: "MÓDULO FÍSICO"},
            {t: "Tribunal Algorítmico", f: "cap06.html", cat: "MÓDULO FÍSICO"},
            {t: "O Patrão Invisível", f: "cap07.html", cat: "MÓDULO SOCIAL"},
            {t: "A Internet Morta", f: "cap08.html", cat: "MÓDULO SOCIAL"},
            {t: "A Nuvem de Pedra", f: "cap09.html", cat: "MÓDULO SOCIAL"},
            {t: "Neuro-direitos", f: "cap10.html", cat: "CONTRA-MEDIDAS"},
            {t: "Protocolo de Retomada", f: "cap11.html", cat: "CONTRA-MEDIDAS"},
            {t: "Tecnofeudalismo", f: "cap12.html", cat: "CONTRA-MEDIDAS"},
            {t: "Imaginação Radical", f: "cap13.html", cat: "CONTRA-MEDIDAS"},
            {t: "Epílogo", f: "cap14.html", cat: "CONTRA-MEDIDAS"},
            {t: "Glossário", f: "cap15.html", cat: "DATABASE"}
        ];

        let currentIdx = 0, ttsRate = 1.0, currentTheme = 'dark', fontScale = 1.0, isPlaying = false;

        function initMenu() {
            const container = document.getElementById('links-container');
            let lastCat = "";
            chapters.forEach((c, i) => {
                if(c.cat !== lastCat) {
                    const cat = document.createElement('div');
                    cat.className = "nav-category";
                    cat.innerText = c.cat;
                    container.appendChild(cat);
                    lastCat = c.cat;
                }
                const a = document.createElement('a');
                a.href = "#";
                a.className = "chapter-link" + (i === 0 ? " active" : "");
                a.innerText = c.t.toUpperCase();
                a.onclick = (e) => { e.preventDefault(); load(i); };
                container.appendChild(a);
            });
        }

        function load(idx) {
            currentIdx = idx;
            const frame = document.getElementById('main-frame');
            frame.src = chapters[idx].f;
            document.getElementById('cap-label').innerText = chapters[idx].t.toUpperCase();
            document.querySelectorAll('.chapter-link').forEach((l, i) => l.classList.toggle('active', i === idx));
            
            const p = Math.round(((idx + 1) / chapters.length) * 100);
            document.getElementById('progress-fill').style.width = p + '%';
            document.getElementById('progress-percent').innerText = p + '%';
            
            if(window.innerWidth < 768) document.getElementById('sidebar').classList.remove('open');
            
            // SINCRONIA TOTAL AO CARREGAR
            frame.onload = () => {
                frame.contentWindow.postMessage({type: 'theme', mode: currentTheme}, '*');
                frame.contentWindow.postMessage({type: 'tts-rate', value: ttsRate}, '*');
                frame.contentWindow.postMessage({type: 'font-resize', value: fontScale}, '*');
            };
        }

        // --- CONTROLES OPERACIONAIS ---
        function controlFont(action) {
            fontScale = (action === 'larger') ? Math.min(fontScale + 0.1, 1.5) : Math.max(fontScale - 0.1, 0.8);
            document.getElementById('main-frame').contentWindow.postMessage({type: 'font-resize', value: fontScale}, '*');
        }

        function controlTTS(val) {
            ttsRate = parseFloat((ttsRate + val).toFixed(2));
            ttsRate = Math.max(0.5, Math.min(3.0, ttsRate));
            document.getElementById('speed-val').innerText = ttsRate.toFixed(1) + "X";
            document.getElementById('main-frame').contentWindow.postMessage({type: 'tts-rate', value: ttsRate}, '*');
        }

        function sendTTS(type) {
            document.getElementById('main-frame').contentWindow.postMessage({type: type}, '*');
        }

        // ESCUTA RETORNO DOS CAPÍTULOS (MARCAÇÃO E STATUS)
        window.addEventListener('message', (event) => {
            if (event.data.type === 'tts-status') {
                isPlaying = event.data.isPlaying;
                const btn = document.getElementById('btn-play');
                btn.innerHTML = isPlaying ? 
                    '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>' : 
                    '<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>';
                btn.classList.toggle('active-state', isPlaying);
            }
        });

        function navigate(dir) {
            let n = currentIdx + dir;
            if(n >= 0 && n < chapters.length) load(n);
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            currentTheme = document.body.classList.contains('light-mode') ? 'light' : 'dark';
            document.getElementById('main-frame').contentWindow.postMessage({type: 'theme', mode: currentTheme}, '*');
            const icon = document.getElementById('theme-icon');
            icon.innerHTML = currentTheme === 'light' ? 
                '<circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>' : 
                '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
        }

        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            if(window.innerWidth <= 768) sb.classList.toggle('open');
            else sb.classList.toggle('collapsed');
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else if (document.exitFullscreen) document.exitFullscreen();
        }

        window.onload = () => { initMenu(); load(0); };
    </script>
</body>
</html>
