<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cap√≠tulo 05 // A Cidade Invis√≠vel</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* [F√ìRMULA X CSS: ID√äNTICO AO CAP 04] */
        :root {
            --bg-app: #050505; --bg-panel: rgba(20, 20, 23, 0.98); 
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #ededed; --text-secondary: #888888;
            --accent: #3b82f6; --accent-bio: #10b981; --accent-warn: #d946ef; --accent-alert: #ef4444;
            --radius: 8px;
            --font-ui: 'Inter', sans-serif; --font-tech: 'JetBrains Mono', monospace;
            --transition: all 0.2s ease; --blur: blur(12px);
            --reading-size: 14px; 
        }
        body.light-mode {
            --bg-app: #f2f2f7; --bg-panel: rgba(255, 255, 255, 0.98); 
            --border-color: rgba(0, 0, 0, 0.08);
            --text-primary: #1c1c1e; --text-secondary: #6c6c70;
            --accent: #007aff; --accent-bio: #16a34a; --accent-warn: #af52de;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-app); color: var(--text-primary); font-family: var(--font-ui); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        .reading-hud {
            height: 60px; flex-shrink: 0;
            background: var(--bg-panel); backdrop-filter: var(--blur);
            border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: center;
            gap: 8px; z-index: 100; padding: 0 15px;
        }
        .hud-btn {
            width: 40px; height: 40px; flex-shrink: 0;
            background: transparent; border: 1px solid transparent;
            color: var(--text-secondary); border-radius: var(--radius);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-family: var(--font-tech); font-weight: 500; font-size: 14px;
            transition: var(--transition);
        }
        .hud-btn:hover { background: rgba(255,255,255,0.05); color: var(--text-primary); border-color: var(--border-color); }
        .hud-btn.active { color: var(--text-primary); border-color: var(--border-color); background: rgba(255,255,255,0.05); }
        .hud-divider { width: 1px; height: 18px; background: var(--border-color); margin: 0 2px; }
        .speed-indicator { font-family: var(--font-tech); font-size: 12px; color: var(--text-secondary); min-width: 35px; text-align: center; letter-spacing: -0.5px; }
        @media (max-width: 600px) {
            .reading-hud { padding: 0 5px; gap: 2px; justify-content: space-between; }
            .hud-btn { width: 38px; height: 38px; }
            .hud-divider { display: none; } 
        }

        .content-scroll-area { flex: 1; overflow-y: auto; overflow-x: hidden; padding: 40px 20px 100px 20px; scroll-behavior: smooth; }
        .book-container { max-width: 750px; margin: 0 auto; font-size: var(--reading-size); line-height: 1.8; }
        
        h1 { font-family: var(--font-tech); font-size: 2.2em; text-transform: uppercase; letter-spacing: 2px; color: var(--text-primary); border-bottom: 2px solid var(--accent); padding-bottom: 20px; margin-bottom: 40px; text-align: center; }
        h2 { font-family: var(--font-tech); font-size: 1.5em; text-transform: uppercase; letter-spacing: 1px; color: var(--accent); margin-top: 3em; margin-bottom: 1em; display: flex; align-items: center; gap: 10px; }
        h2::before { content: '//'; opacity: 0.5; }
        h3 { font-family: var(--font-ui); font-size: 1.2em; font-weight: 600; color: var(--accent-warn); margin-top: 2em; text-transform: uppercase; }
        p { margin-bottom: 1.5em; text-align: justify; color: var(--text-primary); opacity: 0.95; transition: opacity 0.2s; } p:hover { opacity: 1; }
        .chapter-meta { text-align: center; font-family: var(--font-tech); font-size: 0.8em; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; opacity: 0.7; }

        /* Cap 05 Specifc */
        .box { border-radius: var(--radius); padding: 25px; margin: 3em 0; font-size: 0.95em; position: relative; }
        .thesis-box { background: rgba(59, 130, 246, 0.05); border: 1px solid rgba(59, 130, 246, 0.3); border-left: 4px solid var(--accent); }
        .antithesis-box { background: rgba(16, 185, 129, 0.05); border: 1px solid rgba(16, 185, 129, 0.3); border-left: 4px solid var(--accent-bio); position: relative; }
        .antithesis-tag { position: absolute; top: -12px; right: 20px; background: var(--bg-app); color: var(--accent-bio); border: 1px solid var(--accent-bio); padding: 2px 10px; font-weight: bold; font-family: var(--font-tech); text-transform: uppercase; font-size: 0.7rem; }
        .deep-dive-box { border-top: 1px dashed var(--border-color); border-bottom: 1px dashed var(--border-color); padding: 30px 0; }
        .action-box { background: linear-gradient(180deg, rgba(16, 185, 129, 0.05) 0%, transparent 100%); border: 1px solid var(--accent-bio); text-align: center; }
        .action-title { color: var(--accent-bio); font-family: var(--font-tech); font-weight: bold; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px; }

        /* Layers Visual */
        .visual-layers-container {
            background: rgba(255,255,255,0.02); border: 1px solid var(--border-color);
            border-radius: var(--radius); padding: 30px; margin: 3em 0; position: relative; overflow: hidden;
            font-family: var(--font-tech); cursor: pointer;
        }
        .layers-title { text-align: center; color: var(--accent-warn); font-weight: bold; text-transform: uppercase; margin-bottom: 20px; display: block; font-size: 0.8rem; letter-spacing: 1px; }
        .layer-item { padding: 15px; margin-bottom: 5px; border-radius: 6px; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 2; transition: transform 0.3s; }
        .layer-item:hover { transform: scale(1.02); }
        .layer-3 { background: rgba(217, 70, 239, 0.1); color: var(--accent-warn); border: 1px solid var(--accent-warn); }
        .layer-2 { background: rgba(59, 130, 246, 0.1); color: var(--accent); border: 1px solid var(--accent); }
        .layer-1 { background: rgba(255, 255, 255, 0.05); color: var(--text-secondary); border: 1px dashed var(--text-secondary); }
        .arrow-down { text-align: center; color: var(--text-secondary); font-size: 1.2rem; margin: -5px 0; opacity: 0.5; }

        /* Table Cap 5 */
        .dissection-table-container { margin: 2em 0; overflow-x: auto; border: 1px solid var(--border-color); border-radius: var(--radius); }
        .dissection-table { width: 100%; border-collapse: collapse; font-family: var(--font-ui); font-size: 0.85rem; min-width: 600px; }
        .dissection-table th, .dissection-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: top; }
        .dissection-table th { background: rgba(255,255,255,0.05); color: var(--accent); text-transform: uppercase; letter-spacing: 1px; font-size: 0.75rem; font-family: var(--font-tech); }
        .dissection-table tr:hover { background: rgba(255,255,255,0.02); }
        .col-impact { color: var(--accent-alert); font-weight: bold; }
        .tech-tag { font-size: 0.75rem; background: rgba(255,255,255,0.1); padding: 2px 5px; border-radius: 3px; margin-right: 3px; display: inline-block; margin-top: 5px; font-family: var(--font-tech); }

        /* Generic Table */
        .visual-table-container { border: 1px solid var(--border-color); border-radius: var(--radius); overflow: hidden; margin: 3em 0; }
        .visual-header { background: rgba(255,255,255,0.05); padding: 12px; font-family: var(--font-tech); font-size: 0.8em; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--border-color); }
        .simple-table { width: 100%; border-collapse: collapse; }
        .simple-table td { padding: 15px; border-bottom: 1px solid var(--border-color); color: var(--text-primary); }

        .reading-highlight { background: rgba(59, 130, 246, 0.15); border-radius: var(--radius); box-shadow: 0 0 20px rgba(59, 130, 246, 0.1); color: #fff; }
    </style>
</head>
<body>

    <div class="reading-hud">
        <button class="hud-btn" onclick="toggleTheme()" title="Tema">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        </button>

        <div class="hud-divider"></div>

        <button class="hud-btn" onclick="changeFontSize(-1)" title="Diminuir Fonte">A-</button>
        <button class="hud-btn" onclick="changeFontSize(1)" title="Aumentar Fonte">A+</button>

        <div class="hud-divider"></div>

        <button class="hud-btn" onclick="changeSpeed(-0.25)" title="Lento">¬´</button>
        <span class="speed-indicator" id="speed-val">1.0x</span>
        <button class="hud-btn" onclick="changeSpeed(0.25)" title="R√°pido">¬ª</button>
        
        <button class="hud-btn" id="btn-speak" onclick="toggleSpeech()" title="Narrar">
            <svg id="icon-play" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
        </button>
    </div>

    <div class="content-scroll-area" id="content-area">
        <div class="book-container">
            <div class="chapter-meta">Parte II: O Corpo e o Territ√≥rio | Cap√≠tulo 05</div>
            <h1>Smart Cities vs. Tecnologias Ancestrais</h1>

            <p>Voc√™ caminha pela avenida. Um poste de luz acende quando voc√™ se aproxima ‚Äì "Que conveniente", voc√™ pensa. Mas no topo desse poste, uma c√¢mera de alta resolu√ß√£o registra seu rosto, analisa sua marcha e cruza esses dados com o sinal de GPS do seu celular. Tr√™s quarteir√µes adiante, um outdoor digital muda a propaganda de fraldas para cerveja, porque o algoritmo detectou que homens da sua faixa et√°ria e n√≠vel de renda est√£o passando por ali agora.</p>

            <p>A cidade deixou de ser feita apenas de concreto, vidro e a√ßo. Ela agora √© feita de c√≥digo. A promessa da <strong>Smart City</strong> (Cidade Inteligente) √© a efici√™ncia suprema: tr√¢nsito sem engarrafamentos, lixo recolhido na hora exata, seguran√ßa total. Mas a pesquisadora Shannon Mattern nos alerta em <em>A City Is Not a Computer</em>: quando tratamos a cidade como uma m√°quina de processamento de dados, transformamos os cidad√£os em meros componentes operacionais.</p>

            <p>A "Smart City" √© a realiza√ß√£o final do Pan√≥ptico de Bentham: uma pris√£o onde a visibilidade √© uma armadilha, e n√£o h√° para onde correr, porque a pr√≥pria infraestrutura est√° assistindo.</p>

            <h2>A Tese: O Urbanismo de Vigil√¢ncia</h2>

            <p>Nas cidades "otimizadas", o acaso √© considerado um erro de sistema. O objetivo √© a previsibilidade total. Isso gera fen√¥menos como a <strong>Gentrifica√ß√£o Automatizada</strong>: softwares como o RealPage utilizam algoritmos para coordenar o aumento de alugu√©is em bairros inteiros simultaneamente, expulsando moradores locais com uma efici√™ncia fria que nenhum propriet√°rio humano conseguiria sozinho.</p>

            <div class="box thesis-box">
                <strong style="color: var(--accent); text-transform: uppercase; font-family: var(--font-tech);">// A Cidade como Servi√ßo (CaaS):</strong><br><br>
                "O cidad√£o √© rebaixado a 'usu√°rio'. E, como qualquer usu√°rio, seu acesso pode ser revogado. Na China, o sistema de Cr√©dito Social j√° impede que pessoas com 'score baixo' comprem passagens de trem. No Ocidente, a exclus√£o √© financeira e invis√≠vel: catracas que s√≥ abrem com biometria, parques que rastreiam seu celular, bairros onde a pol√≠cia preditiva decide quem abordar antes mesmo do crime acontecer."
            </div>

            <div class="visual-layers-container">
                <span class="layers-title">üèôÔ∏è RECURSO VISUAL 6: A ANATOMIA DA CIDADE INVIS√çVEL</span>
                
                <div class="layer-item layer-3">
                    <span>CAMADA 3: O ALGORITMO (Controle)</span>
                    <span style="font-size: 0.7em;">L√≥gica: Bloquear/Liberar</span>
                </div>
                <div class="arrow-down">‚Üì</div>
                
                <div class="layer-item layer-2">
                    <span>CAMADA 2: A SENS√ìRIA (Vigil√¢ncia)</span>
                    <span style="font-size: 0.7em;">C√¢meras, Sensores, Wi-Fi</span>
                </div>
                <div class="arrow-down">‚Üì</div>
                
                <div class="layer-item layer-1">
                    <span>CAMADA 1: A CIDADE F√çSICA (Realidade)</span>
                    <span style="font-size: 0.7em;">Pessoas, Ruas, Concreto</span>
                </div>
                
                <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 20px; text-align: center; font-style: italic;">
                    "Na Smart City, a Camada 3 (Virtual) dita as regras da Camada 1 (F√≠sica). O c√≥digo molda o concreto."
                </p>
            </div>

            <div class="box deep-dive-box">
                <h3>Dissec√ß√£o do Controle: A Matriz de Usurpa√ß√£o Urbana</h3>
                <p>Para entender a profundidade da usurpa√ß√£o, precisamos dissecar a cidade em camadas. Adam Greenfield, em <em>Radical Technologies</em>, argumenta que esses sensores n√£o s√£o neutros; s√£o "agentes pol√≠ticos" que tomam decis√µes por n√≥s. Abaixo, detalhamos o que realmente est√° sendo capturado e como isso anula sua vontade individual.</p>

                <div class="dissection-table-container">
                    <table class="dissection-table">
                        <thead>
                            <tr>
                                <th style="width: 15%;">Camada</th>
                                <th style="width: 30%;">Dados Capturados & Tecnologia</th>
                                <th style="width: 25%;">A "Utilidade" (O Pretexto)</th>
                                <th style="width: 30%;">A Usurpa√ß√£o (O Custo Real)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>1. Biometria Passiva</strong></td>
                                <td>
                                    Rosto, Marcha, √çris.<br>
                                    <span class="tech-tag">Reconhecimento Facial</span> <span class="tech-tag">C√¢meras T√©rmicas</span>
                                </td>
                                <td>Seguran√ßa, Acesso "sem toque", Pagamento r√°pido.</td>
                                <td class="col-impact">Fim do direito ao anonimato. Seu corpo se torna uma credencial p√∫blica que voc√™ n√£o pode "deslogar".</td>
                            </tr>
                            <tr>
                                <td><strong>2. Rastro Digital (Cin√©tica)</strong></td>
                                <td>
                                    Localiza√ß√£o GPS, MAC Address, Trajeto.<br>
                                    <span class="tech-tag">IMSI Catchers</span> <span class="tech-tag">Wi-Fi Sniffing</span>
                                </td>
                                <td>Otimiza√ß√£o de Tr√¢nsito, Planejamento Urbano.</td>
                                <td class="col-impact">Previsibilidade for√ßada. A cidade sabe onde voc√™ vai antes de voc√™ ir, manipulando fluxos para √°reas de consumo.</td>
                            </tr>
                            <tr>
                                <td><strong>3. Infer√™ncia Psicom√©trica</strong></td>
                                <td>
                                    Micro-express√µes, Tom de Voz, Agita√ß√£o.<br>
                                    <span class="tech-tag">Emotion AI</span> <span class="tech-tag">Microfones</span>
                                </td>
                                <td>"Seguran√ßa Preditiva", An√°lise de Satisfa√ß√£o.</td>
                                <td class="col-impact">Usurpa√ß√£o da Interioridade. A cidade julga sua <em>inten√ß√£o</em> (ex: nervosismo = culpa) antes de qualquer ato.</td>
                            </tr>
                            <tr>
                                <td><strong>4. Metadados de Consumo</strong></td>
                                <td>
                                    Lixo gerado, √Ågua, Energia, Compras.<br>
                                    <span class="tech-tag">Smart Meters</span> <span class="tech-tag">RFID</span>
                                </td>
                                <td>Sustentabilidade, Efici√™ncia Energ√©tica.</td>
                                <td class="col-impact">Vigil√¢ncia Dom√©stica. O que voc√™ faz dentro de casa (banhos, horas acordado) √© auditado e precificado.</td>
                            </tr>
                            <tr>
                                <td><strong>5. Governan√ßa Algor√≠tmica</strong></td>
                                <td>
                                    Cruzamento de todos os dados acima.<br>
                                    <span class="tech-tag">Black Box Algorithms</span>
                                </td>
                                <td>Gest√£o "Neutra" e Eficiente.</td>
                                <td class="col-impact">Morte da Pol√≠tica. Decis√µes morais (quem recebe aux√≠lio, quem √© policiado) viram c√°lculos matem√°ticos opacos.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p>Rob Kitchin chama isso de "Governan√ßa Algor√≠tmica": a substitui√ß√£o do debate pol√≠tico (falho, mas humano e negoci√°vel) pela l√≥gica matem√°tica (eficiente, mas r√≠gida e excludente). A sua vontade de transitar livremente √© substitu√≠da pela permiss√£o do sistema.</p>
            </div>

            <p>O espa√ßo p√∫blico, outrora o palco da democracia, do protesto e do encontro inesperado, est√° sendo reconfigurado como um shopping center a c√©u aberto, monitorado por olhos de sil√≠cio que classificam quem √© "consumidor leg√≠timo" e quem √© "amea√ßa √† ordem".</p>

            <div class="box deep-dive-box">
                <h3>Fator X: O Direito √† Cidade</h3>
                <p>O soci√≥logo <strong>Henri Lefebvre</strong> argumentou, em 1968, que o "Direito √† Cidade" n√£o √© apenas o direito de acessar o que j√° existe, mas o direito de <em>transformar</em> a cidade e transform√°-la em algo novo. A Smart City nega esse direito. Ela oferece uma cidade pronta, otimizada e imut√°vel. O cidad√£o √© consumidor de servi√ßos urbanos, n√£o criador do espa√ßo urbano. A luta contempor√¢nea √© pelo "Direito √† Opacidade": o direito de n√£o ser rastreado para poder ser livre.</p>
            </div>

            <h2>Ant√≠tese: Te Mana Raraunga e a Cidade Soberana</h2>

            <p>Existe alternativa a esse totalitarismo digital? Sim, e ela vem das tradi√ß√µes mais antigas do planeta. Na Nova Zel√¢ndia (Aotearoa), o povo Maori desenvolveu o conceito de <strong>Soberania de Dados Ind√≠gena</strong>, codificado nos princ√≠pios de <em>Te Mana Raraunga</em>.</p>

            <p>Para o Vale do Sil√≠cio, dados s√£o "o novo petr√≥leo" ‚Äì um recurso morto para ser extra√≠do e vendido. Para os Maori, dados s√£o <strong>Taonga</strong> (um tesouro sagrado/ancestral). Eles acreditam que os dados t√™m <em>Whakapapa</em> (genealogia/linhagem). Se um dado vem de uma pessoa ou de uma terra, ele mant√©m uma conex√£o espiritual e pol√≠tica com sua origem.</p>

            <div class="box antithesis-box">
                <span class="antithesis-tag">O Contraponto Ancestral</span>
                <p><strong>Do Controle ao Cuidado (Kaitiakitanga):</strong></p>
                <p>Imagine uma cidade onde os sensores n√£o vigiam as pessoas, mas vigiam a sa√∫de do rio para garantir que ele n√£o seja polu√≠do. Onde os dados de tr√°fego n√£o s√£o vendidos para o Google, mas pertencem ao bairro e s√£o usados pelos moradores para decidir onde plantar √°rvores.</p>
                <p>Isso n√£o √© fic√ß√£o. Projetos de <strong>Tecnologia Comunit√°ria</strong> usam sensores low-tech para monitorar desmatamento ou qualidade da √°gua, devolvendo o poder aos habitantes. A tecnologia deixa de ser uma arma de extra√ß√£o (de cima para baixo) e se torna uma ferramenta de cuidado (de baixo para cima).</p>
                <p>A "Cidade Soberana" respeita a opacidade do indiv√≠duo e a transpar√™ncia do poder. Na "Smart City", √© o inverso: o indiv√≠duo √© transparente e o poder √© opaco.</p>
            </div>

            <div class="visual-table-container">
                <div class="visual-header">üó∫Ô∏è TECNOLOGIA: EXTRA√á√ÉO VS. RELA√á√ÉO</div>
                <table class="simple-table">
                    <tbody>
                        <tr>
                            <td style="color:var(--accent);"><strong>Smart City (Ocidental)</strong></td>
                            <td>Dado como <em>Commodity</em> (Mercadoria). Foco em Efici√™ncia e Controle.</td>
                        </tr>
                        <tr>
                            <td style="color:var(--accent-bio);"><strong>Cidade Soberana (Ind√≠gena)</strong></td>
                            <td>Dado como <em>Taonga</em> (Tesouro). Foco em Cuidado e Responsabilidade.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>S√≠ntese: O Direito √† Deriva</h2>

            <p>A maior rebeli√£o contra a cidade algor√≠tmica √© a inefici√™ncia proposital. O algoritmo quer que voc√™ v√° do ponto A ao ponto B pelo caminho mais r√°pido (e mais monitorado). Ele quer que voc√™ consuma no trajeto.</p>

            <p>Para recuperar o "Direito √† Cidade" (Henri Lefebvre), precisamos praticar a <strong>Deriva Situacionista</strong>. Caminhar sem destino. Explorar as "zonas mortas" onde o GPS falha. Habitar os espa√ßos que n√£o foram otimizados para o consumo.</p>

            <p>A cidade real vive nas rachaduras do c√≥digo. Vive na conversa fiada na esquina que nenhuma c√¢mera gravou √°udio. Vive no mercado informal que n√£o aceita pagamento digital. Vive na humanidade que se recusa a ser um ponto de dados em um painel de controle.</p>

            <div class="box action-box">
                <div class="action-title">üö∂‚Äç‚ôÇÔ∏è DESAFIO DE RETOMADA #05</div>
                <p><strong>A Caminhada Anal√≥gica (The Glitch Walk)</strong></p>
                <p>O algoritmo do Google Maps molda a geografia f√≠sica da cidade ao direcionar o fluxo de milh√µes de pessoas para as mesmas ruas.</p>
                <p><strong>Sua miss√£o hoje:</strong> Saia de casa sem destino e <strong>sem celular</strong> (ou com ele no modo avi√£o, no fundo da mochila). Caminhe guiado apenas pela curiosidade visual. Vire numa rua porque achou a √°rvore bonita, n√£o porque o Waze mandou.</p>
                <p>Descubra o que a "Smart City" est√° escondendo de voc√™. Redescubra a textura da cidade que existe antes de ser convertida em dados. Seja imprevis√≠vel.</p>
            </div>

        </div>
    </div>

    <script>
        // --- F√ìRMULA X ENGINE ---
        function toggleTheme() { document.body.classList.toggle('light-mode'); }
        
        let currentSize = 14; 
        function changeFontSize(amount) {
            currentSize += amount; if(currentSize < 14) currentSize = 14; if(currentSize > 32) currentSize = 32;
            document.documentElement.style.setProperty('--reading-size', currentSize + 'px');
        }

        let speechRate = 1.0, isSpeaking = false, speechQueue = [], currentSpeechIndex = 0, isChangingState = false;
        
        function changeSpeed(amount) {
            speechRate += amount; if(speechRate < 0.5) speechRate = 0.5; if(speechRate > 2.5) speechRate = 2.5;
            document.getElementById('speed-val').innerText = speechRate.toFixed(1) + 'x';
            if(isSpeaking) { isChangingState = true; window.speechSynthesis.cancel(); setTimeout(() => { isChangingState = false; speakChunk(); }, 50); }
        }

        function toggleSpeech() {
            const btn = document.getElementById('btn-speak');
            if (isSpeaking) {
                isChangingState = true; window.speechSynthesis.cancel(); isSpeaking = false; 
                btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>';
                btn.classList.remove('active');
            } else {
                prepareQueue();
                if(speechQueue.length > 0) {
                    isSpeaking = true; btn.classList.add('active');
                    btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>';
                    speakChunk();
                }
            }
        }

        function prepareQueue() { const container = document.querySelector('.book-container'); const elements = container.querySelectorAll('p, h1, h2, h3, li, td, .box, .layer-item'); speechQueue = Array.from(elements).filter(el => el.innerText.trim().length > 0); }
        function clearHighlights() { document.querySelectorAll('.reading-highlight').forEach(el => el.classList.remove('reading-highlight')); }

        function speakChunk() {
            if (!isSpeaking) return;
            if (currentSpeechIndex >= speechQueue.length) { isSpeaking = false; currentSpeechIndex = 0; toggleSpeech(); return; }
            const element = speechQueue[currentSpeechIndex];
            clearHighlights(); element.classList.add('reading-highlight'); element.scrollIntoView({behavior: "smooth", block: "center"});
            const utterance = new SpeechSynthesisUtterance(element.innerText); utterance.lang = 'pt-BR'; utterance.rate = speechRate;
            utterance.onend = function() { if (isSpeaking && !isChangingState) { currentSpeechIndex++; speakChunk(); } if(isChangingState) isChangingState = false; };
            window.speechSynthesis.speak(utterance);
        }

        document.getElementById('content-area').addEventListener('click', function(e) {
            const target = e.target.closest('p, h1, h2, h3, .box, td, li, .layer-item');
            if (target) { prepareQueue(); let index = speechQueue.indexOf(target); if (index !== -1) { isChangingState = true; window.speechSynthesis.cancel(); currentSpeechIndex = index; isSpeaking = true; document.getElementById('btn-speak').classList.add('active'); document.getElementById('btn-speak').innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'; setTimeout(() => { isChangingState = false; speakChunk(); }, 50); } }
        });
        window.onbeforeunload = function() { window.speechSynthesis.cancel(); };
    </script>
</body>
</html>
